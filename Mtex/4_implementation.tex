\section{実装}
\pagenumbering{arabic}

現在の提案システムの実装はサーバマシンとクライアントマシンがXMPPサーバから取得した情報をもとに直接リンクを張ってクラウドゲーミング通信を展開する方式になっている。クラウドゲームサーバ/クライアントにはオープンソースクラウドゲーミングプラットフォームであるGamingAnywhereを使用している。また、パブリッククラウド等で展開しているサービスではなく、一般のユーザコンピュータでサービスを展開する手法特有の課題とその対処についても本章で述べる。

\subsection{実装上の課題}
パブリッククラウドやビジネス向けのサーバでサービスを展開する場合と異なり、提案システムはクラウドゲームサーバをボランティアの提供するユーザコンピュータ上で展開する。通常ユーザコンピュータはNATやファイアウォールの背後にあり、また固定IPアドレスを持っていないことも多いため直接通信することが難しい。これにより提案システムが必要とする通信において、大きく2つ問題が生じる箇所が出てくる。一つはクラウド上のコントローラから遊休コンピュータへクラウドゲームのホスティング等の直接命令を送ることができないということである。もう一つは、クラウドゲームサーバ/クライアントを展開する遊休コンピュータとプレイヤーPC間での通信において、双方向的な直接通信を展開できないという点である。

\subsection{VCコントローラとエージェントの連携}
VCコントローラと遊休コンピュータ上で動作するVCホストエージェントとの通信の課題についてはgRPC\cite{grpc}を用いる。gRPCはGoogleが開発しているオープンソースのRPCサービスで、異なるコンピュータ間あるいはマイクロサービス間で情報をやり取りするのに使われる。gRPCではクライアントアプリケーションがローカルオブジェクトであるかのようにサーバアプリケーションのメソッドを直接呼び出すことができるため、分散アプリケーション等の実装に適している。サーバ側ではサービスを定義してそのインターフェースを実装する。クライアント側ではサーバと同じメソッドを提供するスタブを介してサーバアプリケーションの機能を使えるようにしているのが特徴である。

gRPCのResponse Streaming gRPCという機能は、単一のリクエストに対して複数のレスポンスを返すことが可能である。これを使用することで、VCクライアントが送信した単一のゲームプレイリクエストに対して、ACKや起動報告、ホスティング終了時の完了報告、エラーの通知など様々なレスポンスを返すことができる。

\subsection{クラウドゲームサーバ/クライアント間のP2P通信}

GamingAnywhere
クラウドゲームサーバとクラウドゲームクライアントとしてGamingAnywhereを使用する

EdgeVPN
\cite{edgevpn}

St Justeら\cite{tincan}が開発した
P2P型のオーバーレイネットワークツール。ネットワークのユーザ/グループ管理が可能。TinCanの論文引用して紹介する。

\subsection{システム動作}

